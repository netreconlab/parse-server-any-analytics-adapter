{"version":3,"file":"storage-utils.js","sources":["../../../analytics-util-storage-global/dist/analytics-util-global-storage.module.js","../../../analytics-util-storage-cookie/dist/analytics-util-cookie.module.js","../../../analytics-util-storage-local/dist/analytics-util-localstorage.module.js","../../../analytics-util-types/dist/analytics-util-types.module.js","../../src/utils/parse.js","../../src/index.js"],"sourcesContent":["var l=\"global\",o=\"undefined\",e=\"object\"==typeof self&&self.self===self&&self||\"object\"==typeof global&&global.global===global&&global||void 0;function f(l){return e[l]}function n(l,o){return e[l]=o,o}function t(l){n(l)}export{l as GLOBAL,f as get,e as globalContext,t as remove,n as set,o as undef};\n//# sourceMappingURL=analytics-util-global-storage.module.js.map\n","import{undef as e,remove as o,set as t,get as n}from\"@analytics/global-storage-utils\";var i=\"cookie\",r=p(),c=d,u=d;function a(e){return r?d(e,\"\",-1):o(e)}function p(){if(typeof r!==e)return r;try{d(\"__x\",\"__x\"),r=-1!==document.cookie.indexOf(\"__x\"),a(\"__x\")}catch(e){r=!1}return r}function d(o,i,c,u,a,p){if(typeof window!==e){var d=arguments.length>1;return r||(d?t(o,i):n(o)),d?document.cookie=o+\"=\"+encodeURIComponent(i)+(c?\"; expires=\"+new Date(+new Date+1e3*c).toUTCString()+(u?\"; path=\"+u:\"\")+(a?\"; domain=\"+a:\"\")+(p?\"; secure\":\"\"):\"\"):decodeURIComponent(((\"; \"+document.cookie).split(\"; \"+o+\"=\")[1]||\"\").split(\";\")[0])}}export{i as COOKIE,c as getCookie,p as hasCookies,a as removeCookie,u as setCookie};\n//# sourceMappingURL=analytics-util-cookie.module.js.map\n","import{undef as t,get as e,set as o,remove as r}from\"@analytics/global-storage-utils\";var a=\"localStorage\",l=c();function c(){if(typeof l!==t)return l;l=!0;try{typeof localStorage!==t&&typeof JSON!==t||(l=!1),localStorage.setItem(t,t),localStorage.removeItem(t)}catch(t){l=!1}return l}function n(t){return l?localStorage.getItem(t):e(t)}function g(t,e){return l?localStorage.setItem(t,e):o(t,e)}function u(t){return l?localStorage.removeItem(t):r(t)}export{a as LOCAL_STORAGE,n as getItem,c as hasLocalStorage,u as removeItem,g as setItem};\n//# sourceMappingURL=analytics-util-localstorage.module.js.map\n","var n,e=\"function\",t=\"string\",o=\"undefined\",r=\"boolean\",i=\"object\",u=\"array\",c=\"number\",a=function(){},f=\"any\",l=\"*\",s=\"none\",d=\"hidden\",p=\"form\",g=\"input\",y=\"button\",b=\"select\",m=\"change\",v=\"submit\",j=\"undefined\"!=typeof process?process:{},h=(null==(n=j.env)?void 0:n.NODE_ENV)||\"\",A=\"production\"===h,O=\"staging\"===h,w=\"development\"===h,Z=\"undefined\"!=typeof window,z=Z&&\"localhost\"===window.location.hostname,N=null!=j.versions&&null!=j.versions.node,S=\"undefined\"!=typeof Deno&&void 0!==Deno.core,P=\"object\"==typeof self&&self.constructor&&\"DedicatedWorkerGlobalScope\"===self.constructor.name,D=Z&&\"nodejs\"===window.name||\"undefined\"!=typeof navigator&&(navigator.userAgent.includes(\"Node.js\")||navigator.userAgent.includes(\"jsdom\"));function E(n,e){return typeof e===n}var C=E.bind(null,\"function\"),L=E.bind(null,\"string\"),$=E.bind(null,\"undefined\"),x=E.bind(null,\"boolean\");function F(n){return null===n}function T(n){return!isNaN(parseFloat(n))}function _(n){return!!C(n)&&/^class /.test(Function.prototype.toString.call(n))}function k(n){return\"[object Array]\"===Object.prototype.toString.call(n)}function G(n){return n&&(\"object\"==typeof n||null!==n)}function H(n){if(!G(n))return!1;for(var e=n;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}function M(n){if(F(n))return!0;switch(typeof n){case\"string\":case\"number\":case\"symbol\":case\"undefined\":case\"boolean\":return!0;default:return!1}}function R(n){return!!n&&!!(!$(Promise)&&n instanceof Promise||n.then&&C(n.then))}function U(n){return n instanceof RegExp}function V(n){return G(n)&&L(n.message)&&L(n.name)}function W(n){if(!C(n))return!1;var e=/{(\\r|\\n|\\s)*}/gm,t=a.toString();return t===(n.toString().match(e)||[\"\"])[0].replace(e,t)}function q(n){return!(L(n)&&\"false\"===n.toLowerCase()||!n)}function B(n){return!(n.length>320)&&/^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(n)}function I(n){return/^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d\\.\\d+([+-][0-2]\\d:[0-5]\\d|Z)$/.test(n)}function J(n){return NodeList.prototype.isPrototypeOf(n)}function K(n,e){var t=n instanceof Element||n instanceof HTMLDocument;return t&&e?Q(n,e):t}function Q(n,e){return void 0===e&&(e=\"\"),n&&n.nodeName===e.toUpperCase()}function X(n){return function(){return n.apply(void 0,[].slice.call(arguments).concat([].slice.call(arguments,1)))}}var Y=X(K),nn=X(K),en=X(K),tn=X(K);function on(n,e){if(!n||\"hidden\"===getComputedStyle(n).visibility)return!0;for(;n;){if(null!=e&&n===e)return!1;if(\"none\"===getComputedStyle(n).display)return!0;n=n.parentElement}return!1}export{l as ALL,f as ANY,u as ARRAY,r as BOOLEAN,y as BUTTON,m as CHANGE,h as ENV,p as FORM,e as FUNCTION,d as HIDDEN,g as INPUT,s as NONE,c as NUMBER,i as OBJECT,b as SELECT,t as STRING,v as SUBMIT,o as UNDEFINED,k as isArray,x as isBoolean,Z as isBrowser,nn as isButton,_ as isClass,S as isDeno,w as isDev,K as isElement,B as isEmail,V as isErrorLike,Y as isForm,C as isFunction,on as isHidden,en as isInput,I as isIsoDate,D as isJsDom,z as isLocalHost,W as isNoOp,N as isNode,J as isNodeList,Q as isNodeType,F as isNull,T as isNumber,H as isObject,G as isObjectLike,M as isPrimitive,A as isProd,R as isPromise,U as isRegex,tn as isSelect,O as isStaging,L as isString,q as isTruthy,$ as isUndefined,P as isWebWorker,a as noOp,E as typeOf};\n//# sourceMappingURL=analytics-util-types.module.js.map\n","import { isObject } from '@analytics/type-utils'\n/**\n * Safe JSON parse\n * @param  {*} input - value to parse\n * @return {*} parsed input\n */\nexport default function parse(input) {\n  let value = input\n  try {\n    value = JSON.parse(input)\n    if (value === 'true') return true\n    if (value === 'false') return false\n    if (isObject(value)) return value\n    if (parseFloat(value) === value) {\n      value = parseFloat(value)\n    }\n  } catch (e) { }\n  if (value === null || value === \"\") {\n    return\n  }\n  return value\n}\n","import { set, get, remove, globalContext, GLOBAL } from '@analytics/global-storage-utils'\nimport { getCookie, setCookie, removeCookie, hasCookies, COOKIE } from '@analytics/cookie-utils'\nimport { hasLocalStorage, LOCAL_STORAGE } from '@analytics/localstorage-utils'\nimport { isUndefined, isString, ANY, ALL } from '@analytics/type-utils'\nimport parse from './utils/parse'\n\n// Verify support\nconst hasStorage = hasLocalStorage()\nconst hasCookiesSupport = hasCookies()\n\n/**\n * Get storage item from localStorage, cookie, or window\n * @param  {string} key - key of item to get\n * @param  {object|string} [options] - storage options. If string location of where to get storage\n * @param  {string} [options.storage] - Define type of storage to pull from.\n * @return {Any}  the value of key\n */\nexport function getItem(key, options) {\n  if (!key) return\n  const type = getStorageType(options)\n  const getFirst = !useAll(type)\n\n  /* 1. Try localStorage */\n  const localValue = useLocal(type) ? parse(localStorage.getItem(key)) : undefined\n  if (getFirst && !isUndefined(localValue)) {\n    return localValue\n  }\n\n  /* 2. Fallback to cookie */\n  const cookieVal = useCookie(type) ? parse(getCookie(key)) : undefined\n  if (getFirst && cookieVal) {\n    return cookieVal\n  }\n\n  /* 3. Fallback to window/global. */\n  const globalValue = get(key)\n\n  return getFirst ? globalValue : {\n    localStorage: localValue,\n    cookie: cookieVal,\n    global: globalValue\n  }\n}\n\n/**\n * Store values in localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {*} value - value of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n * @returns {object} returns old value, new values, & location of storage\n */\nexport function setItem(key, value, options) {\n  if (!key || isUndefined(value)) {\n    return\n  }\n  const data = {}\n  const type = getStorageType(options)\n  const saveValue = JSON.stringify(value)\n  const setFirst = !useAll(type)\n\n  /* 1. Try localStorage */\n  if (useLocal(type)) {\n    // console.log('SET as localstorage', saveValue)\n    data[LOCAL_STORAGE] = format(LOCAL_STORAGE, value, parse(localStorage.getItem(key)))\n    // Set LocalStorage item\n    localStorage.setItem(key, saveValue)\n    if (setFirst) {\n      return data[LOCAL_STORAGE]\n    }\n  }\n\n  /* 2. Fallback to cookie */\n  if (useCookie(type)) {\n    // console.log('SET as cookie', saveValue)\n    data[COOKIE] = format(COOKIE, value, parse(getCookie(key)))\n    // Set Cookie\n    setCookie(key, saveValue)\n    if (setFirst) {\n      return data[COOKIE]\n    }\n  }\n\n  /* 3. Fallback to window/global */\n  data[GLOBAL] = format(GLOBAL, value, get(key))\n  // Set global value\n  set(key, value)\n  // Return set value(s)\n  return (setFirst) ? data[GLOBAL] : data\n}\n\n/**\n * Remove values from localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n */\nexport function removeItem(key, options) {\n  if (!key) return\n  const type = getStorageType(options)\n  const values = getItem(key, ALL)\n\n  const data = {}\n  if (!isUndefined(values.localStorage) && useLocal(type)) {\n    /* 1. Try localStorage */\n    localStorage.removeItem(key)\n    data[LOCAL_STORAGE] = values.localStorage\n  }\n  if (!isUndefined(values.cookie) && useCookie(type)) {\n    /* 2. Fallback to cookie */\n    removeCookie(key)\n    data[COOKIE] = values.cookie\n  }\n  /* 3. Fallback to window/global */\n  if (!isUndefined(values.global) && useGlobal(type)) {\n    remove(key)\n    data[GLOBAL] = values.global\n  }\n  return data\n}\n\nfunction getStorageType(opts) {\n  if (!opts) return ANY\n  return isString(opts) ? opts : opts.storage\n}\n\nfunction useGlobal(storage) {\n  return useType(storage, GLOBAL)\n}\n\nfunction useLocal(storage) {\n  // If has localStorage and storage option not defined, or is set to 'localStorage' or '*'\n  return hasStorage && useType(storage, LOCAL_STORAGE)\n}\n\nfunction useCookie(storage) {\n  // If has cookies and storage option not defined, or is set to 'cookies' or '*'\n  return hasCookiesSupport && useType(storage, COOKIE)\n}\n\nfunction useAll(storage) {\n  return storage === ALL || storage === 'all'\n}\n\nfunction useType(storage, type) {\n  return (storage === ANY || storage === type || useAll(storage))\n}\n\n/**\n * Format response\n * @param {string} location \n * @param {*} current - current value\n * @param {*} previous - previous value\n * @returns \n */\nfunction format(location, current, previous) {\n  return { location, current, previous }\n}\n\n// const TYPES = {\n//   ALL,\n//   ANY,\n//   GLOBAL,\n//   COOKIE,\n//   LOCAL_STORAGE,\n// }\n\nexport {\n  ALL,\n  ANY,\n  GLOBAL,\n  COOKIE,\n  LOCAL_STORAGE,\n  getCookie,\n  setCookie,\n  removeCookie,\n  globalContext,\n  hasLocalStorage,\n  hasCookies\n}\n\nexport default {\n  setItem,\n  getItem,\n  removeItem\n}"],"names":["GLOBAL","undef","globalContext","self","global","this","get","key","set","value","remove","COOKIE","isSupported","hasCookies","getCookie","cookie","setCookie","removeCookie","name","document","indexOf","e","ttl","path","domain","secure","window","isSet","arguments","length","encodeURIComponent","Date","toUTCString","decodeURIComponent","split","LOCAL_STORAGE","hasLocalStorage","localStorage","JSON","setItem","removeItem","err","ANY","process","isBrowser","typeOf","type","val","Deno","navigator","userAgent","includes","bind","isString","isUndefined","parse","input","obj","isObjectLike","proto","Object","getPrototypeOf","isObject","parseFloat","hasStorage","hasCookiesSupport","getItem","options","getStorageType","getFirst","useAll","localValue","useLocal","undefined","cookieVal","useCookie","globalValue","data","saveValue","stringify","setFirst","format","values","useType","opts","storage","location","current","previous"],"mappings":"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"}